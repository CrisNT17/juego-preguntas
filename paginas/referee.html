<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Panel del Juez</title>
    <style>
        body { background: #1a1a2e; color: white; font-family: Arial; padding: 20px; }
        .container { max-width: 600px; margin: 0 auto; }
        .panel { background: #16213e; padding: 20px; border-radius: 10px; margin: 20px 0; }
        button { padding: 15px 30px; margin: 10px; font-size: 18px; border: none; border-radius: 5px; cursor: pointer; }
        .btn-primary { background: #00ff88; }
        .btn-danger { background: #ff3366; color: white; }
        .btn-warning { background: #ffaa00; }
        .marcador { display: flex; justify-content: space-around; font-size: 32px; margin: 20px 0; }
        .j1 { color: #ff3366; } .j2 { color: #33ccff; }
        .led { display: inline-block; width: 15px; height: 15px; border-radius: 50%; margin-right: 5px; }
        .led-on { background: #0f0; box-shadow: 0 0 10px #0f0; }
        .led-off { background: #333; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üë®‚Äç‚öñÔ∏è PANEL DEL JUEZ</h1>
        
        <!-- Estado de conexi√≥n -->
        <div class="panel" id="conexion">
            üîå Conectando a la Pico...
        </div>
        
        <!-- Marcador -->
        <div class="panel">
            <div class="marcador">
                <div class="j1">
                    <span class="led" id="ledJ1"></span>
                    J1: <span id="score1">0</span>
                </div>
                <div style="color:#ffaa00;">VS</div>
                <div class="j2">
                    <span class="led" id="ledJ2"></span>
                    J2: <span id="score2">0</span>
                </div>
            </div>
        </div>
        
        <!-- Control de puntos -->
        <div class="panel" style="text-align: center;">
            <h3>Control de puntos</h3>
            <button class="btn-primary" onclick="darPunto(1)">‚ûï Punto J1</button>
            <button class="btn-primary" onclick="darPunto(2)">‚ûï Punto J2</button>
            <button class="btn-danger" onclick="rechazar()">‚ùå Rechazar</button>
            <button class="btn-warning" onclick="reiniciar()">üîÑ Reiniciar</button>
        </div>
        
        <!-- √öltimo evento -->
        <div class="panel" id="eventos">
            üìã Esperando eventos...
        </div>
    </div>

    <script>
        // Variables globales
        let ultimoPresiono = null;
        
        // Funci√≥n para dar punto
        async function darPunto(jugador) {
            console.log(`üéØ Dando punto a J${jugador}`);
            await fetch('/api/punto', {
                method: 'POST',
                body: `jugador=${jugador}`
            });
            agregarEvento(`‚úÖ Punto manual J${jugador}`);
            actualizar();
        }
        
        // Funci√≥n para rechazar
        async function rechazar() {
            console.log("‚ùå Rechazando");
            await fetch('/api/rechazar', { method: 'POST' });
            agregarEvento("‚ùå Jugada rechazada");
            actualizar();
        }
        
        // Funci√≥n para reiniciar
        async function reiniciar() {
            console.log("üîÑ Reiniciando");
            await fetch('/api/reiniciar', { method: 'POST' });
            agregarEvento("üîÑ Juego reiniciado");
            actualizar();
        }
        
        // Funci√≥n para agregar evento al historial
        function agregarEvento(texto) {
            const div = document.getElementById('eventos');
            const hora = new Date().toLocaleTimeString();
            div.innerHTML = `<div>${hora} - ${texto}</div>` + div.innerHTML;
        }
        
        // Funci√≥n principal de actualizaci√≥n
        async function actualizar() {
            try {
                const res = await fetch('/api/estado');
                if (!res.ok) throw new Error(`HTTP ${res.status}`);
                
                const data = await res.json();
                console.log("üìä Estado recibido:", data);
                
                // Actualizar marcador
                document.getElementById('score1').textContent = data.puntaje_j1 || 0;
                document.getElementById('score2').textContent = data.puntaje_j2 || 0;
                
                // Actualizar LEDs
                document.getElementById('ledJ1').className = data.led_j1 ? 'led led-on' : 'led led-off';
                document.getElementById('ledJ2').className = data.led_j2 ? 'led led-on' : 'led led-off';
                
                // Actualizar estado de conexi√≥n
                document.getElementById('conexion').innerHTML = '‚úÖ Conectado a la Pico';
                
                // Si alguien presion√≥ f√≠sicamente
                if (data.ultimo_presiono && data.ultimo_presiono !== ultimoPresiono) {
                    agregarEvento(`üëÜ Jugador ${data.ultimo_presiono} presion√≥`);
                    ultimoPresiono = data.ultimo_presiono;
                }
                
            } catch (e) {
                console.error('‚ùå Error:', e);
                document.getElementById('conexion').innerHTML = '‚ùå Error conectando a la Pico';
            }
        }
        
        // Actualizar cada 200ms
        setInterval(actualizar, 200);
        actualizar();
    </script>
</body>
</html>
