<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Panel del Juez</title>
    <style>
        body { background: #1a1a2e; color: white; font-family: Arial; padding: 20px; }
        .container { max-width: 600px; margin: 0 auto; }
        .panel { background: #16213e; padding: 20px; border-radius: 10px; margin: 20px 0; }
        button { padding: 15px 30px; margin: 10px; font-size: 18px; border: none; border-radius: 5px; cursor: pointer; }
        .btn-primary { background: #00ff88; }
        .btn-danger { background: #ff3366; color: white; }
        .marcador { display: flex; justify-content: space-around; font-size: 32px; margin: 20px 0; }
        .j1 { color: #ff3366; } .j2 { color: #33ccff; }
        .led { display: inline-block; width: 15px; height: 15px; border-radius: 50%; margin-right: 5px; }
        .led-on { background: #0f0; box-shadow: 0 0 10px #0f0; }
        .led-off { background: #333; }
        input { padding: 10px; width: 200px; margin: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üë®‚Äç‚öñÔ∏è PANEL DEL JUEZ</h1>
        
        <!-- Configuraci√≥n de IP -->
        <div class="panel">
            <h3>‚öôÔ∏è Configuraci√≥n</h3>
            <label>IP de la Pico:</label>
            <input type="text" id="picoIP" placeholder="192.168.1.xxx" value="192.168.1.100">
            <button class="btn-primary" onclick="guardarIP()">Guardar</button>
            <div id="conexion">üîå Esperando...</div>
        </div>
        
        <!-- Marcador -->
        <div class="panel">
            <div class="marcador">
                <div class="j1">
                    <span class="led" id="ledJ1"></span>
                    J1: <span id="score1">0</span>
                </div>
                <div style="color:#ffaa00;">VS</div>
                <div class="j2">
                    <span class="led" id="ledJ2"></span>
                    J2: <span id="score2">0</span>
                </div>
            </div>
        </div>
        
        <!-- Pregunta (simulada) -->
        <div class="panel">
            <h2>üìù PREGUNTA ACTUAL</h2>
            <div id="pregunta">Cargando...</div>
            <div id="opciones"></div>
        </div>
        
        <!-- Control -->
        <div class="panel" style="text-align: center;">
            <button class="btn-primary" onclick="darPunto(1)">‚ûï Punto J1</button>
            <button class="btn-primary" onclick="darPunto(2)">‚ûï Punto J2</button>
            <button class="btn-danger" onclick="rechazar()">‚ùå Rechazar</button>
            <button class="btn-danger" onclick="reiniciar()">üîÑ Reiniciar</button>
        </div>
        
        <!-- Eventos -->
        <div class="panel" id="eventos">
            üìã Esperando eventos...
        </div>
    </div>

    <script>
        let ipPico = localStorage.getItem('picoIP') || '192.168.1.100';
        let ultimoPresiono = null;
        
        // Inicializar
        document.getElementById('picoIP').value = ipPico;
        
        function guardarIP() {
            ipPico = document.getElementById('picoIP').value;
            localStorage.setItem('picoIP', ipPico);
            document.getElementById('conexion').innerHTML = '‚úÖ IP guardada';
            actualizar();
        }
        
        async function llamarAPI(endpoint, metodo = 'GET', datos = null) {
            try {
                const url = `http://${ipPico}${endpoint}`;
                console.log(`üì° Llamando a: ${url}`);
                
                const options = {
                    method: metodo,
                    mode: 'cors',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' }
                };
                
                if (datos) {
                    options.body = datos;
                }
                
                const res = await fetch(url, options);
                if (!res.ok) throw new Error(`HTTP ${res.status}`);
                
                if (metodo === 'GET') {
                    return await res.json();
                }
                return true;
                
            } catch (e) {
                console.error('‚ùå Error:', e);
                document.getElementById('conexion').innerHTML = '‚ùå Error conectando';
                throw e;
            }
        }
        
        async function darPunto(jugador) {
            try {
                await llamarAPI('/api/punto', 'POST', `jugador=${jugador}`);
                agregarEvento(`‚úÖ Punto J${jugador}`);
                actualizar();
            } catch (e) {}
        }
        
        async function rechazar() {
            try {
                await llamarAPI('/api/rechazar', 'POST');
                agregarEvento("‚ùå Jugada rechazada");
                actualizar();
            } catch (e) {}
        }
        
        async function reiniciar() {
            try {
                await llamarAPI('/api/reiniciar', 'POST');
                agregarEvento("üîÑ Juego reiniciado");
                actualizar();
            } catch (e) {}
        }
        
        function agregarEvento(texto) {
            const div = document.getElementById('eventos');
            const hora = new Date().toLocaleTimeString();
            div.innerHTML = `<div>${hora} - ${texto}</div>` + div.innerHTML;
        }
        
        async function actualizar() {
            try {
                const data = await llamarAPI('/api/estado');
                
                document.getElementById('score1').textContent = data.puntaje_j1 || 0;
                document.getElementById('score2').textContent = data.puntaje_j2 || 0;
                document.getElementById('ledJ1').className = data.led_j1 ? 'led led-on' : 'led led-off';
                document.getElementById('ledJ2').className = data.led_j2 ? 'led led-on' : 'led led-off';
                document.getElementById('conexion').innerHTML = '‚úÖ Conectado';
                
                // Pregunta simulada
                const preguntas = [
                    {texto: "¬øCu√°l es la capital de Francia?", ops: ["Par√≠s", "Londres", "Madrid", "Roma"]},
                    {texto: "¬øQui√©n pint√≥ la Mona Lisa?", ops: ["Da Vinci", "Picasso", "Van Gogh", "Miguel √Ångel"]},
                    {texto: "¬øCu√°nto es 7x8?", ops: ["48", "54", "56", "63"]}
                ];
                const p = preguntas[Math.floor(Math.random() * preguntas.length)];
                document.getElementById('pregunta').textContent = p.texto;
                let opsHtml = '';
                p.ops.forEach((op, i) => {
                    opsHtml += `<div>${String.fromCharCode(65+i)}: ${op}</div>`;
                });
                document.getElementById('opciones').innerHTML = opsHtml;
                
                if (data.ultimo_presiono && data.ultimo_presiono !== ultimoPresiono) {
                    agregarEvento(`üëÜ Jugador ${data.ultimo_presiono} presion√≥`);
                    ultimoPresiono = data.ultimo_presiono;
                }
                
            } catch (e) {}
        }
        
        setInterval(actualizar, 1000);
        actualizar();
    </script>
</body>
</html>
