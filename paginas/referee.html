<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Panel del Juez</title>
    <style>
        body { background: #1a1a2e; color: white; font-family: Arial; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .panel { background: #16213e; padding: 20px; border-radius: 10px; margin: 20px 0; }
        button { padding: 15px 30px; margin: 5px; font-size: 16px; border: none; border-radius: 5px; cursor: pointer; }
        .btn-primary { background: #00ff88; }
        .btn-danger { background: #ff3366; color: white; }
        .btn-warning { background: #ffaa00; }
        .btn-success { background: #33ccff; }
        .marcador { display: flex; justify-content: space-around; font-size: 32px; margin: 20px 0; }
        .j1 { color: #ff3366; } .j2 { color: #33ccff; }
        .led { display: inline-block; width: 15px; height: 15px; border-radius: 50%; margin-right: 5px; }
        .led-on { background: #0f0; box-shadow: 0 0 10px #0f0; }
        .led-off { background: #333; }
        .pregunta { background: #0f3460; padding: 20px; font-size: 24px; border-radius: 10px; margin: 20px 0; }
        .opciones { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 20px 0; }
        .opcion { padding: 15px; background: #0f3460; border-radius: 5px; cursor: pointer; text-align: center; }
        .opcion:hover { background: #ffaa00; }
        .opcion.seleccionada { background: #00ff88; color: black; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üë®‚Äç‚öñÔ∏è PANEL DEL JUEZ</h1>
        
        <!-- Estado de conexi√≥n -->
        <div class="panel" id="conexion">
            üîå Conectando a la Pico...
        </div>
        
        <!-- PREGUNTAS (AHORA S√ç VISIBLE) -->
        <div class="panel">
            <h2>üìù PREGUNTA ACTUAL</h2>
            <div class="pregunta" id="pregunta">
                ‚è≥ Cargando pregunta...
            </div>
            <div class="opciones" id="opciones">
                <div class="opcion" onclick="seleccionarOpcion(1)">A: Cargando...</div>
                <div class="opcion" onclick="seleccionarOpcion(2)">B: Cargando...</div>
                <div class="opcion" onclick="seleccionarOpcion(3)">C: Cargando...</div>
                <div class="opcion" onclick="seleccionarOpcion(4)">D: Cargando...</div>
            </div>
            
            <!-- Control de preguntas -->
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn-success" onclick="nuevaPregunta()">üé≤ NUEVA PREGUNTA</button>
            </div>
        </div>
        
        <!-- Marcador -->
        <div class="panel">
            <div class="marcador">
                <div class="j1">
                    <span class="led" id="ledJ1"></span>
                    J1: <span id="score1">0</span>
                </div>
                <div style="color:#ffaa00;">VS</div>
                <div class="j2">
                    <span class="led" id="ledJ2"></span>
                    J2: <span id="score2">0</span>
                </div>
            </div>
        </div>
        
        <!-- Control de puntos -->
        <div class="panel" style="text-align: center;">
            <h3>‚ö° CONTROL DE JUGADA</h3>
            <button class="btn-primary" onclick="aprobarRespuesta()">‚úÖ APROBAR</button>
            <button class="btn-danger" onclick="rechazar()">‚ùå RECHAZAR</button>
            <button class="btn-warning" onclick="reiniciar()">üîÑ REINICIAR</button>
        </div>
        
        <!-- √öltimo evento -->
        <div class="panel" id="eventos">
            üìã Esperando eventos...
        </div>
    </div>

    <script>
        // ========== BASE DE DATOS LOCAL DE PRUEBA ==========
        const preguntasPrueba = [
            {
                texto: "¬øCu√°l es la capital de Francia?",
                opciones: ["Par√≠s", "Londres", "Madrid", "Roma"],
                correcta: 1
            },
            {
                texto: "¬øQui√©n pint√≥ la Mona Lisa?",
                opciones: ["Miguel √Ångel", "Da Vinci", "Picasso", "Van Gogh"],
                correcta: 2
            },
            {
                texto: "¬øEn qu√© a√±o lleg√≥ Col√≥n a Am√©rica?",
                opciones: ["1492", "1498", "1502", "1485"],
                correcta: 1
            },
            {
                texto: "¬øCu√°nto es 7 x 8?",
                opciones: ["48", "54", "56", "63"],
                correcta: 3
            },
            {
                texto: "¬øQui√©n escribi√≥ 'Cien a√±os de soledad'?",
                opciones: ["Vargas Llosa", "Garc√≠a M√°rquez", "Borges", "Cort√°zar"],
                correcta: 2
            }
        ];
        
        // Variable para la pregunta actual
        let preguntaActual = preguntasPrueba[0];
        let opcionSeleccionada = null;
        let ultimoPresiono = null;
        
        // ========== FUNCIONES DE PREGUNTAS ==========
        function mostrarPregunta(pregunta) {
            document.getElementById('pregunta').textContent = pregunta.texto;
            
            const opcionesDiv = document.getElementById('opciones');
            opcionesDiv.innerHTML = '';
            
            pregunta.opciones.forEach((opcion, index) => {
                const letra = String.fromCharCode(65 + index); // A, B, C, D
                const div = document.createElement('div');
                div.className = 'opcion';
                div.setAttribute('onclick', `seleccionarOpcion(${index + 1})`);
                div.textContent = `${letra}: ${opcion}`;
                opcionesDiv.appendChild(div);
            });
            
            opcionSeleccionada = null;
        }
        
        function seleccionarOpcion(opcion) {
            opcionSeleccionada = opcion;
            
            // Quitar selecci√≥n anterior
            document.querySelectorAll('.opcion').forEach(el => {
                el.classList.remove('seleccionada');
            });
            
            // Marcar la seleccionada
            event.target.classList.add('seleccionada');
            
            agregarEvento(`üî∏ Opci√≥n ${String.fromCharCode(64 + opcion)} seleccionada`);
        }
        
        function nuevaPregunta() {
            // Elegir pregunta aleatoria
            const randomIndex = Math.floor(Math.random() * preguntasPrueba.length);
            preguntaActual = preguntasPrueba[randomIndex];
            mostrarPregunta(preguntaActual);
            agregarEvento(`üé≤ Nueva pregunta: ${preguntaActual.texto}`);
        }
        
        async function aprobarRespuesta() {
            if (!opcionSeleccionada) {
                alert('Selecciona una respuesta primero');
                return;
            }
            
            const esCorrecta = (opcionSeleccionada === preguntaActual.correcta);
            
            if (esCorrecta) {
                // Si es correcta, dar punto al √∫ltimo que presion√≥
                if (ultimoPresiono === 1) {
                    await fetch('/api/punto', {
                        method: 'POST',
                        body: 'jugador=1'
                    });
                    agregarEvento(`‚úÖ J1 correcto: ${preguntaActual.opciones[opcionSeleccionada-1]}`);
                } else if (ultimoPresiono === 2) {
                    await fetch('/api/punto', {
                        method: 'POST',
                        body: 'jugador=2'
                    });
                    agregarEvento(`‚úÖ J2 correcto: ${preguntaActual.opciones[opcionSeleccionada-1]}`);
                } else {
                    agregarEvento('‚ö†Ô∏è Nadie presion√≥ primero');
                }
            } else {
                agregarEvento(`‚ùå Incorrecto - La correcta era: ${preguntaActual.opciones[preguntaActual.correcta-1]}`);
            }
            
            // Quitar selecci√≥n
            document.querySelectorAll('.opcion').forEach(el => {
                el.classList.remove('seleccionada');
            });
            opcionSeleccionada = null;
            
            // Actualizar estado
            actualizar();
        }
        
        // ========== FUNCIONES DE API ==========
        async function darPunto(jugador) {
            console.log(`üéØ Dando punto a J${jugador}`);
            await fetch('/api/punto', {
                method: 'POST',
                body: `jugador=${jugador}`
            });
            agregarEvento(`‚úÖ Punto manual J${jugador}`);
            actualizar();
        }
        
        async function rechazar() {
            console.log("‚ùå Rechazando");
            await fetch('/api/rechazar', { method: 'POST' });
            agregarEvento("‚ùå Jugada rechazada");
            actualizar();
        }
        
        async function reiniciar() {
            console.log("üîÑ Reiniciando");
            await fetch('/api/reiniciar', { method: 'POST' });
            agregarEvento("üîÑ Juego reiniciado");
            opcionSeleccionada = null;
            document.querySelectorAll('.opcion').forEach(el => {
                el.classList.remove('seleccionada');
            });
            actualizar();
        }
        
        // ========== FUNCIONES DE ESTADO ==========
        function agregarEvento(texto) {
            const div = document.getElementById('eventos');
            const hora = new Date().toLocaleTimeString();
            div.innerHTML = `<div>${hora} - ${texto}</div>` + div.innerHTML;
            
            // Limitar a 10 eventos
            while (div.children.length > 10) {
                div.removeChild(div.lastChild);
            }
        }
        
        async function actualizar() {
            try {
                const res = await fetch('/api/estado');
                if (!res.ok) throw new Error(`HTTP ${res.status}`);
                
                const data = await res.json();
                console.log("üìä Estado:", data);
                
                // Actualizar marcador
                document.getElementById('score1').textContent = data.puntaje_j1 || 0;
                document.getElementById('score2').textContent = data.puntaje_j2 || 0;
                
                // Actualizar LEDs
                document.getElementById('ledJ1').className = data.led_j1 ? 'led led-on' : 'led led-off';
                document.getElementById('ledJ2').className = data.led_j2 ? 'led led-on' : 'led led-off';
                
                // Actualizar estado de conexi√≥n
                document.getElementById('conexion').innerHTML = '‚úÖ Conectado a la Pico';
                
                // Si alguien presion√≥ f√≠sicamente
                if (data.ultimo_presiono && data.ultimo_presiono !== ultimoPresiono) {
                    agregarEvento(`üëÜ Jugador ${data.ultimo_presiono} presion√≥ BOT√ìN F√çSICO`);
                    ultimoPresiono = data.ultimo_presiono;
                }
                
            } catch (e) {
                console.error('‚ùå Error:', e);
                document.getElementById('conexion').innerHTML = '‚ùå Error conectando a la Pico';
            }
        }
        
        // ========== INICIALIZAR ==========
        // Mostrar primera pregunta
        mostrarPregunta(preguntaActual);
        
        // Actualizar cada 200ms
        setInterval(actualizar, 200);
        actualizar();
    </script>
</body>
</html>
